# P1 Discovery (гипотеза без реальных пользователей)

## 1. Продуктовая цель
Сделать graph-first IDE для CPG, которая за 1-2 минуты отвечает на вопросы:
- как устроен вызовный контур функции;
- как течет data flow от определения к использованию;
- какие пакеты критичны и как связаны между модулями.

## 2. Гипотеза о пользователе
**Primary persona:** Senior Go Engineer / SRE в observability-команде, который:
- поддерживает Prometheus-экосистему;
- ревьюит сложные PR и расследует регрессии;
- регулярно работает с незнакомыми участками кода.

**Контекст использования:** PR-review, инцидент, онбординг нового инженера, impact-анализ перед рефакторингом.

## 3. JTBD (Jobs To Be Done)
1. Когда я вижу незнакомую функцию, я хочу быстро построить ее call-neighborhood, чтобы понять контекст изменений.
2. Когда я анализирую баг по данным, я хочу проследить forward/backward data flow, чтобы найти источник и эффект.
3. Когда я планирую изменение в пакете, я хочу видеть карту зависимостей, чтобы оценить blast radius.

## 4. Ключевые пользовательские задачи
1. Найти сущность (функция/переменная/пакет).
2. Построить фокусный подграф (10-100 узлов).
3. Перейти из узла к исходнику и обратно в граф.
4. Перестроить анализ из текущего контекста за 1-2 клика.

## 5. User Stories (MVP)
1. Как инженер, я ищу функцию по имени и получаю стартовый call-граф, чтобы быстро понять окружение.
2. Как инженер, я кликаю узел в графе и вижу исходный код и метаданные, чтобы подтвердить гипотезу.
3. Как инженер, я строю backward/forward slice для переменной, чтобы понять путь данных.
4. Как инженер, я открываю карту пакетов и вижу зависимости между модулями, чтобы оценить архитектурный контекст.
5. Как проверяющий, я запускаю `docker compose up` и получаю рабочее приложение без ручной настройки.

## 6. Acceptance Criteria (на P1)
- Для типового запроса граф строится не более чем за 2 секунды (p95) при ограничении размера подграфа.
- В каждом режиме есть корректные состояния `loading`, `empty`, `error`.
- Клик по узлу всегда открывает связанный контекст (детали + исходник или понятная причина отсутствия).
- Все сценарии из User Stories выполняются end-to-end в одном запуске через Docker.

## 7. Scope (MoSCoW на 24 часа)
**Must**
- Graph canvas как центральная часть UI.
- Call neighborhood с BFS-расширением.
- Dataflow slice (forward/backward).
- Package dependency map.
- Source panel + переходы из графа.
- Docker Compose запуск без ручных шагов.

**Should**
- Поиск символов и context trail.
- Серверные лимиты `max_depth/max_nodes`.
- Базовая телеметрия ошибок и latency.

**Could**
- Сохранение пресетов запросов.
- Горячие клавиши навигации.

**Won't (P1)**
- Полноценный multi-user режим.
- Полная отрисовка всего графа без фильтрации.
- RBAC/SSO и production-hardening.

## 8. Нефункциональные требования
- Работа с полной БД CPG (сотни тысяч узлов, миллионы ребер) через фокусные подграфы.
- Предсказуемая деградация: лимиты, таймауты, понятные ошибки.
- Реплицируемость окружения через Docker.

## 9. Риски и меры
1. **Перегрузка графа** -> жесткие лимиты + progressive expansion.
2. **Медленные SQL-запросы** -> индексные/предподготовленные запросы + таймаут API.
3. **Неочевидный UX для новых пользователей** -> 2-3 guided entry points (Calls/Dataflow/Packages).

## 10. Метрики успеха P1
- Task success rate по 3 ключевым сценариям >= 80%.
- Median time-to-insight по сценарию call/dataflow <= 3 минут.
- Ошибки API (5xx) <= 2% на smoke-наборе сценариев.

## 11. Что должно быть готово после успешного Discovery (Definition of Ready)
1. One-page PRD с целями, гипотезами и ограничениями.
2. Подтвержденный MVP scope (`Must/Should/Could/Won't`).
3. Набор user stories с acceptance criteria.
4. Технические решения верхнего уровня (архитектура, стек, границы backend/frontend).
5. План итераций (2-3 коротких этапа) и критерии готовности (`DoD`) на каждую.
6. Список рисков и план валидации гипотез на прототипе.

## 12. План итераций (кратко)
1. **Iteration 1:** каркас UI/API + Calls end-to-end.
2. **Iteration 2:** Dataflow + Packages + source navigation.
3. **Iteration 3:** производительность, UX-состояния, README, docker smoke.
